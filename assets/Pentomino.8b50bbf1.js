import{_ as g,o as l,c,F as b,r as E,m as z,b as B,d as _,e as P,w as q,f as p,g as f,a as m,h as k,p as V,i as j}from"./index.79f0fd0c.js";import{_ as o,l as v}from"./lodash.45c0b1b1.js";const F={name:"Shape",props:{shape:Object},inheritAttrs:!1,computed:{outline(){return this.shape.outline().map(e=>e.map(s=>s.join(",")).join("  "))}}},N={class:"shape"},O=["points"];function T(r,e,s,t,i,n){return l(),c("g",N,[(l(!0),c(b,null,E(n.outline,(a,u)=>(l(),c("polygon",z({points:a,key:u},r.$attrs),[B(r.$slots,"default")],16,O))),128))])}var L=g(F,[["render",T]]);const W={name:"Piece",props:{piece:Object},components:{Shape:L}},Y={class:"piece","pointer-events":"none"};function Z(r,e,s,t,i,n){const a=_("Shape");return l(),c("g",Y,[P(a,{shape:s.piece.shape,fill:"brown",stroke:"black","stroke-width":"0.2"},{default:q(()=>[B(r.$slots,"default")]),_:3},8,["shape"])])}var H=g(W,[["render",Z]]);const A={name:"Hole",props:{hole:Object},components:{Shape:L,Piece:H},computed:{warning_attrs(){var r={},e=this.hole.hole_warning();return e==3?(r.stroke="gold",r["stroke-width"]="0.3"):e==2?(r.stroke="darkorange",r["stroke-width"]="0.4"):e==1&&(r.stroke="red",r["stroke-width"]="0.5"),r}}},R={class:"hole"},U=m("rect",{class:"hole-bg",width:"12",height:"14",fill:"none","pointer-events":"all"},null,-1),X={key:0},D={key:0,dur:"300ms",repeatCount:"indefinite",path:"M 0 0 L 0.08 0.025 L -0.025 0.08 L -0.08 -0.025 Z"},J={key:1,dur:"125ms",repeatCount:"indefinite",path:"M 0 0 L 0.2 0.1 L -0.1 0.2 L -0.2 -0.1 Z"};function K(r,e,s,t,i,n){const a=_("Shape"),u=_("Piece");return l(),c("g",R,[U,P(a,z({shape:s.hole.shape,fill:"black",transform:"translate(2,2)","pointer-events":"none"},n.warning_attrs),{default:q(()=>[s.hole.hole_warning()==3?(l(),c("animate",X)):p("",!0)]),_:1},16,["shape"]),(l(!0),c(b,null,E(s.hole.pieces,(h,w)=>(l(),f(u,{key:w,piece:h.piece,transform:"translate("+(2+h.x)+","+(2+h.y)+")","pointer-events":"none"},{default:q(()=>[w==s.hole.pieces.length-1&&s.hole.piece_warning()==2?(l(),c("animateMotion",D)):p("",!0),w==s.hole.pieces.length-1&&s.hole.piece_warning()==1?(l(),c("animateMotion",J)):p("",!0)]),_:2},1032,["piece","transform"]))),128))])}var Q=g(A,[["render",K]]);class d{constructor(e){this.squares=e}add(e){this.squares.push(e)}x_min(e){var s=this.squares;return e!=null&&(s=o.filter(s,t=>t[1]==e)),o.min(o.map(s,t=>t[0]))}y_min(e){var s=this.squares;return e!=null&&(s=o.filter(s,t=>t[0]==e)),o.min(o.map(s,t=>t[1]))}x_max(e){var s=this.squares;return e!=null&&(s=o.filter(s,t=>t[1]==e)),o.max(o.map(s,t=>t[0]))}y_max(e){var s=this.squares;return e!=null&&(s=o.filter(s,t=>t[0]==e)),o.max(o.map(s,t=>t[1]))}outline(){var e=[];for(const[n,a]of this.squares)this.includes([n,a+1])||e.push([n,a+1,n+1,a+1]),this.includes([n+1,a])||e.push([n+1,a+1,n+1,a]),this.includes([n,a-1])||e.push([n+1,a,n,a]),this.includes([n-1,a])||e.push([n,a,n,a+1]);for(var s=[];e.length;){var t=e.pop(),i=[];do i.push([t[0],t[1]]),t=e.find(n=>n[0]==t[2]&&n[1]==t[3]),o.pull(e,t);while(t);s.push(i)}return s}difference(e,s=[0,0]){return new d(o.differenceWith(this.squares,o.map(e.squares,([t,i])=>[t+s[0],i+s[1]]),o.isEqual))}overlaps(e,s=[0,0]){return o.intersectionWith(this.squares,o.map(e.squares,([t,i])=>[t+s[0],i+s[1]]),o.isEqual).length>0}includes(e){for(var s of this.squares)if(o.isEqual(e,s))return!0;return!1}empty(){return this.squares.length==0}rot_cw(){this.squares=o.map(this.squares,([e,s])=>[-s,e])}rot_ccw(){this.squares=o.map(this.squares,([e,s])=>[s,-e])}flip(){this.squares=o.map(this.squares,([e,s])=>[-e,s])}static from_grid(e,s=[0,0]){var t=[];for(var i of v.exports.range(e.length))for(var n of v.exports.range(e[i].length))e[i][n]&&t.push([n+s[0],i+s[1]]);return new d(t)}}var I=[{name:"P1",weight:22,shape:[[1,1],[1,1],[1,0]]},{name:"P2",weight:22,shape:[[1,1,1],[1,1,0]]},{name:"F1",weight:14,shape:[[0,1,1],[1,1,0],[0,1,0]]},{name:"F2",weight:14,shape:[[0,1,0],[1,1,1],[1,0,0]]},{name:"Y",weight:14*2,shape:[[0,0,1,0],[1,1,1,1]]},{name:"N",weight:8*2,shape:[[0,0,1,1],[1,1,1,0]]},{name:"L",weight:8*2,shape:[[0,0,0,1],[1,1,1,1]]},{name:"T1",weight:7,shape:[[1,1,1],[0,1,0],[0,1,0]]},{name:"T2",weight:7,shape:[[1,0,0],[1,1,1],[1,0,0]]},{name:"W",weight:4*2,shape:[[1,0,0],[1,1,0],[0,1,1]]},{name:"V",weight:4*2,shape:[[1,0,0],[1,0,0],[1,1,1]]},{name:"U1",weight:4,shape:[[1,1],[0,1],[1,1]]},{name:"U2",weight:4,shape:[[1,0,1],[1,1,1]]},{name:"Z1",weight:4,shape:[[1,1,0],[0,1,0],[0,1,1]]},{name:"Z2",weight:4,shape:[[1,0,0],[1,1,1],[0,0,1]]},{name:"X",weight:3*2,shape:[[0,1,0],[1,1,1],[0,1,0]]},{name:"I",weight:4,shape:[[1,1,1,1,1]]}],$=I.map(r=>r.weight).reduce((r,e)=>r+e,0);class M{constructor(e,s){this.shape=d.from_grid(e,[-Math.floor(e[0].length/2),-Math.floor(e.length/2)]),this.name=s,this.horizontal=!0}get height(){return this.shape.length}get width(){return o.max(this.shape.map(e=>e.length))||0}rot_cw(){this.shape.rot_cw(),this.horizontal=!this.horizontal}rot_ccw(){this.shape.rot_ccw(),this.horizontal=!this.horizontal}flip(){this.shape.flip()}static random(){var e=Math.random()*$,s=0;for(const t of I)if(s+=t.weight,s>e)return new M(t.shape,t.name)}}const S=6,y=8,ee=10,x=8;function G(r,e=ee){if(r<S||e<1)return null;if(r<=y)return[r];var s=o.shuffle(v.exports.range(S,y+1));for(var t of s){var i=G(r-t,e-1);if(i)return i.push(t),i}return null}class C{constructor(e,s){this.id=o.uniqueId("hole"),this.shape=e,this.size=s,this.pieces=[],this.timer=x,this.moves=0}can_place(e,s,t){return t?this.remaining_shape().overlaps(t.shape,[e,s]):!1}add_piece(e,s,t){this.pieces.push({x:e,y:s,piece:t}),this.timer=x,this.moves=this.moves+1}piece_warning(){return this.pieces.length&&this.timer<=2?this.timer:0}hole_warning(){return this.pieces.length==0&&this.timer<=3?this.timer:0}step_timer(){if(this.timer=this.timer-1,this.timer<=0){if(this.pieces.length)this.pieces.pop();else{var e=o.random(this.shape.y_min(),this.shape.y_max()),s=o.random(1)?this.shape.x_min(e)-1:this.shape.x_max(e)+1;this.shape.add([s,e])}this.timer=x}}remaining_shape(){var e=this.shape;for(var{piece:s,x:t,y:i}of this.pieces)e=e.difference(s.shape,[t,i]);return e}filled(){return this.remaining_shape().empty()}static random(e){var s=G(e*5),t=[];return o.forEach(s,(i,n)=>{let a=o.random(y-i);t.push(...o.map(v.exports.range(i),u=>[u+a,n]))}),new C(new d(t),e)}}class se{constructor(){this.hole_size=10,this.holes=[null,null,null,null],this.pieces=[null,null,null],this.active_piece=null,this.score=0,this.combo=0,this.messages=[]}start(){this.holes=[null,null,null,null],this.pieces=[null,null,null],this.active_piece=null,this.score=0,this.combo=0,this.messages=[],this.make_holes(),this.make_pieces()}make_holes(){for(var e of o.range(this.holes.length))this.holes[e]==null&&(this.holes[e]=C.random(this.hole_size))}make_pieces(){for(var e of o.range(this.pieces.length))this.pieces[e]==null&&(this.pieces[e]=M.random())}pick_up(e){[this.active_piece,this.pieces[e]]=[this.pieces[e],this.active_piece]}flip(){this.active_piece&&this.active_piece.flip()}rot_cw(){this.active_piece&&this.active_piece.rot_cw()}rot_ccw(){this.active_piece&&this.active_piece.rot_ccw()}place_active_piece(e,s,t){var i=this.holes[e];if(i.can_place(s,t,this.active_piece)){i.add_piece(s,t,this.active_piece),this.active_piece=null,this.make_pieces();for(var n of this.holes)n!=i&&!n.filled()&&n.step_timer();this.score_hole(i),this.check_filled_holes()}}score_hole(e){if(e.filled()){var s=e.moves-e.size;s==0?(this.combo=this.combo+1,this.score=this.score+80+20*this.combo,this.messages=["Perfect!"],this.combo>1&&(this.messages=["Perfect x"+this.combo+"!"])):s==1?(this.combo=0,this.score=this.score+80,this.messages=["Good"]):s==2?(this.combo=0,this.score=this.score+60,this.messages=["Ok"]):(this.combo=0,this.score=this.score+40,this.messages=["Hmmmm"]),e.pieces.every(t=>t.piece.horizontal)&&(this.messages.push(" Grain Bonus!"),this.score=this.score+20),e.pieces.every(t=>t.piece.name[0]==e.pieces[0].piece.name[0])&&(this.messages.push(" Set Bonus!"),this.score=this.score+20)}}check_filled_holes(){var e=o.map(this.holes,s=>s.filled());e[0]&&e[1]&&e[2]?this.holes=[this.holes[3],null,null,null]:e[0]&&e[1]&&e[3]?this.holes=[null,this.holes[2],null,null]:e[0]&&e[2]&&e[3]?this.holes=[null,null,this.holes[1],null]:e[1]&&e[2]&&e[3]?this.holes=[null,null,null,this.holes[0]]:e[0]&&e[1]?this.holes=[this.holes[2],this.holes[3],null,null]:e[2]&&e[3]?this.holes=[null,null,this.holes[0],this.holes[1]]:e[0]&&e[2]?this.holes=[this.holes[1],null,this.holes[3],null]:e[1]&&e[3]&&(this.holes=[null,this.holes[0],null,this.holes[2]]),this.make_holes()}}const te={name:"PentominoBoard",data(){return{game:new se,mouse_x:10,mouse_y:10}},components:{Hole:Q,Piece:H},methods:{start(){this.game.start()},handle_click(r){r.button==2&&this.game.flip()},handle_wheel(r){r.deltaY>0?this.game.rot_cw():this.game.rot_ccw()},transform_coords(r,e=null){var s=this.$refs.svg,t=s.createSVGPoint();return t.x=r.clientX,t.y=r.clientY,e=e||s,t.matrixTransform(e.getScreenCTM().inverse())},handle_move(r){var e=this.transform_coords(r);this.mouse_x=e.x,this.mouse_y=e.y},place_piece(r,e){if(!!r.target.classList.contains("hole-bg")){var s=this.transform_coords(r,r.target),t=Math.floor(s.x)-2,i=Math.floor(s.y)-2;this.game.place_active_piece(e,t,i)}},warning_color(r,e){return r==1?"red":r==2?"orange":r==3?"DarkGoldenRod":e}}},ie=r=>(V("data-v-c1f8c50a"),r=r(),j(),r),re={class:"wrapper"},ne=["cursor"],oe=ie(()=>m("rect",{x:"0",y:"0",width:"24",height:"35",fill:"none",stroke:"black","stroke-width":"0.1"},null,-1)),ae={transform:"translate(3,14)"},he={transform:"translate(9,14)"},le={transform:"translate(15,14)"};function ce(r,e,s,t,i,n){const a=_("Hole"),u=_("Piece");return l(),c(b,null,[m("button",{onClick:e[0]||(e[0]=k((...h)=>n.start&&n.start(...h),["stop"]))},"Start"),m("div",re,[(l(),c("svg",{class:"puzzle-board pentomino-board",ref:"svg",viewBox:"0 0 24 35",preserveAspectRatio:"xMidYMid meet",cursor:i.game.active_piece?"none":"auto",onContextmenu:e[8]||(e[8]=k(()=>{},["prevent"])),onMouseup:e[9]||(e[9]=(...h)=>n.handle_click&&n.handle_click(...h)),onMousemove:e[10]||(e[10]=(...h)=>n.handle_move&&n.handle_move(...h)),onWheel:e[11]||(e[11]=k((...h)=>n.handle_wheel&&n.handle_wheel(...h),["prevent"]))},[oe,i.game.holes[0]?(l(),f(a,{key:i.game.holes[0].id,hole:i.game.holes[0],transform:"translate(0,0)",onClick:e[1]||(e[1]=h=>n.place_piece(h,0))},null,8,["hole"])):p("",!0),i.game.holes[1]?(l(),f(a,{key:i.game.holes[1].id,hole:i.game.holes[1],transform:"translate(12,0)",onClick:e[2]||(e[2]=h=>n.place_piece(h,1))},null,8,["hole"])):p("",!0),i.game.holes[2]?(l(),f(a,{key:i.game.holes[2].id,hole:i.game.holes[2],transform:"translate(0,21)",onClick:e[3]||(e[3]=h=>n.place_piece(h,2))},null,8,["hole"])):p("",!0),i.game.holes[3]?(l(),f(a,{key:i.game.holes[3].id,hole:i.game.holes[3],transform:"translate(12,21)",onClick:e[4]||(e[4]=h=>n.place_piece(h,3))},null,8,["hole"])):p("",!0),m("g",ae,[m("rect",{height:"6",width:"6",fill:"#EEE",onClick:e[5]||(e[5]=h=>i.game.pick_up(0))}),i.game.pieces[0]?(l(),f(u,{key:0,piece:i.game.pieces[0],"pointer-events":"none",transform:"translate(2.5, 2.5)"},null,8,["piece"])):p("",!0)]),m("g",he,[m("rect",{height:"6",width:"6",fill:"#EEE",onClick:e[6]||(e[6]=h=>i.game.pick_up(1))}),i.game.pieces[1]?(l(),f(u,{key:0,piece:i.game.pieces[1],"pointer-events":"none",transform:"translate(2.5, 2.5)"},null,8,["piece"])):p("",!0)]),m("g",le,[m("rect",{height:"6",width:"6",fill:"#EEE",onClick:e[7]||(e[7]=h=>i.game.pick_up(2))}),i.game.pieces[2]?(l(),f(u,{key:0,piece:i.game.pieces[2],"pointer-events":"none",transform:"translate(2.5, 2.5)"},null,8,["piece"])):p("",!0)]),i.game.active_piece?(l(),f(u,{key:4,piece:i.game.active_piece,"pointer-events":"none",transform:"translate("+Math.floor(i.mouse_x)+","+Math.floor(i.mouse_y)+")"},null,8,["piece","transform"])):p("",!0)],40,ne))])],64)}var pe=g(te,[["render",ce],["__scopeId","data-v-c1f8c50a"]]);const ue={name:"Home",components:{PentominoBoard:pe}},me={class:"puzzle"};function fe(r,e,s,t,i,n){const a=_("PentominoBoard");return l(),c("div",me,[P(a)])}var ge=g(ue,[["render",fe]]);export{ge as default};

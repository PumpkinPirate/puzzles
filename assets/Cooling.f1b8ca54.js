import{_ as A,o as v,c as g,a as d,t as b,j as T,k as $,h as z,u as y,l as V,F as D,r as F,p as L,i as q,e as I,n as M,d as H}from"./index.b3af912b.js";import{_ as i}from"./lodash.45c0b1b1.js";let K=["A","B","C","D","E"];class S{constructor(e,t){this.id=i.uniqueId("piece"),this.kind=e,this.heat=t}score(){return 3-this.heat}static random(){return new S(i.sample(K),3)}}let x=[];function _(a,e){for(const t of i.range(x.length,a+1,1))x[t]=[];for(const t of i.range(x[a].length,e+1,1))x[a][t]=[a,t];return x[a][e]}class U{constructor(){this.width=6,this.height=10,this.maxGroup=6,this.scoreDecay=.5,this.lastScore=0,this.averageScore=null,this.messages=[],this.board=[]}start(){this.lastScore=0,this.averageScore=null,this.messages=[],this.fillBoard()}fillBoard(){this.board=i.map(i.range(this.height),()=>i.map(i.range(this.width),()=>S.random())),this.coolBoard()}boardScore(){return i.sumBy(this.board,e=>i.sumBy(e,t=>t.score()))}rotateChain(e,t){let o=e.map(([c,l])=>({u:c,v:l,piece:this.pieceAt([c,l],e,t)}));for(const{u:c,v:l,piece:u}of o)this.board[c][l]=u;this.coolBoard(),this.newRow(),this.coolBoard()}neighbors([e,t]){let o=[];return e>0&&o.push(_(e-1,t)),t>0&&o.push(_(e,t-1)),e<this.height-1&&o.push(_(e+1,t)),t<this.width-1&&o.push(_(e,t+1)),o}pieceAt([e,t],o=[],c=0){o=o.map(([m,B])=>_(m,B));let l=_(e,t),u=o.indexOf(l);if(u==-1||!c)return this.board[e][t];let h=o.at((u-c)%o.length),[p,w]=h;return this.board[p][w]}coolBoard(){let e=i.map(i.range(this.height),()=>i.map(i.range(this.width),()=>0));for(const t of i.range(this.height))for(const o of i.range(this.width)){if(e[t][o]>0)continue;let c=_(t,o),l=new Set([c]),u=new Set(this.neighbors(c));for(const h of u)if(this.pieceAt(c).kind==this.pieceAt(h).kind){l.add(h);for(const p of this.neighbors(h))l.has(p)||u.add(p)}for(const h of l){let[p,w]=h;e[p][w]=l.size;let m=this.pieceAt(h);m.heat=Math.min(m.heat,Math.max(0,this.maxGroup-l.size))}}}newRow(){this.score(this.board.shift()),this.board.push(i.map(i.range(this.width),()=>S.random()))}score(e){this.lastScore=i.sumBy(e,t=>t.score()),this.averageScore===null?this.averageScore=this.lastScore:this.averageScore=this.averageScore*(1-this.scoreDecay)+this.lastScore*this.scoreDecay}}const Y={"pointer-events":"none"},J=["fill"],Q={x:"-0.5",y:"0.7",fill:"white"},W={props:{piece:Object},setup(a){const e=a;function t(){return{A:"red",B:"green",C:"blue",D:"orange",E:"cyan"}[e.piece.kind]}return(o,c)=>(v(),g("g",Y,[d("circle",{cx:"0",cy:"0",r:"1.3",fill:t()},null,8,J),d("text",Q,b(a.piece.score()),1)]))}};var X=A(W,[["__scopeId","data-v-2fa2384d"]]);const Z={"pointer-events":"all"},j=["stroke"],ee={props:{active:Boolean,first:Boolean},setup(a){const e=a;function t(){return e.first?"black":e.active?"silver":"none"}return(o,c)=>(v(),g("g",Z,[d("rect",{x:"-1.4",y:"-1.4",width:"2.8",height:"2.8",stroke:t(),"stroke-width":"0.2",fill:"none"},null,8,j)]))}};const te=a=>(L("data-v-69fbaa68"),a=a(),q(),a),oe=["onClick"],se={class:"score-box"},ne={class:"wrapper"},re=te(()=>d("rect",{x:"0",y:"0",width:"24",height:"35",fill:"none",stroke:"black","stroke-width":"0.1"},null,-1)),ie={setup(a){let e=T(new U),t=$([]),o=$(null),c=$("");function l(){e.start()}function u(){let n=[];if(!e.board.length)return n;for(const s of i.range(e.height))for(const r of i.range(e.width))n.push({i:s,j:r,piece:e.pieceAt([s,r],t.value,o.value)});return i.sortBy(n,({piece:s})=>s.id)}function h(n,s){return t.value.findIndex(([r,f])=>r==n&&f==s)}function p(n,s){return`transform: translate(${4.5+3*s}px, ${4.5+3*n}px)`}function w(n,s,r){n.target.releasePointerCapture(n.pointerId),R(s,r)}function m(n,s){o.value!==null?N(n,s):h(n,s)==0&&t.value.length>2?G():t.value.length&&E(n,s)}function B(n,s){let r=h(n,s);o.value&&r>=0?O():k()}function R(n,s){t.value=[[n,s]],o.value=null}function E(n,s){var r=h(n,s);r>=0?t.value.splice(r+1):t.value.push([n,s])}function G(){o.value=0}function N(n,s){var r=h(n,s);r>=0&&(o.value=r)}function O(){e.rotateChain(t.value,o.value),k()}function k(){t.value=[],o.value=null}return(n,s)=>(v(),g(D,null,[d("button",{onClick:z(l,["stop"])},"Start",8,oe),d("div",se,[d("p",null,"Last: "+b(y(e).lastScore),1),d("p",null,"Avg: "+b(y(e).averageScore),1),d("p",null,"Board: "+b(y(e).boardScore()),1),V(" "+b(y(c)),1)]),d("div",ne,[(v(),g("svg",{class:"puzzle-board cooling-board",ref:"svg",viewBox:"0 0 24 35",preserveAspectRatio:"xMidYMid meet",onMouseleave:s[0]||(s[0]=r=>k())},[re,(v(!0),g(D,null,F(u(),({i:r,j:f,piece:P})=>(v(),g("g",{key:P.id,class:"piece-container"},[I(ee,{active:h(r,f)>=0,first:h(r,f)==0,style:M(p(r,f)),onPointerdown:z(C=>w(C,r,f),["prevent"]),onPointermove:C=>m(r,f),onPointerup:C=>B(r,f)},null,8,["active","first","style","onPointerdown","onPointermove","onPointerup"]),I(X,{piece:P,style:M([{transition:"transform 0.5s"},p(r,f)])},null,8,["piece","style"])]))),128))],544))])],64))}};var ae=A(ie,[["__scopeId","data-v-69fbaa68"]]);const ce={name:"Home",components:{CoolingBoard:ae}},le={class:"puzzle"};function he(a,e,t,o,c,l){const u=H("CoolingBoard");return v(),g("div",le,[I(u)])}var pe=A(ce,[["render",he]]);export{pe as default};

import{_ as $,o as _,c as g,a as v,t as M,j as S,k,h as B,u as A,F as y,r as E,p as R,i as D,n as G,e as z,d as F}from"./index.3a30f848.js";import{_ as s}from"./lodash.45c0b1b1.js";let L=["A","B","C","D","E"];class x{constructor(e,t){this.id=s.uniqueId("piece"),this.kind=e,this.heat=t}static random(){return new x(s.sample(L),3)}}let b=[];function w(i,e){console.log(`Loc ${i} ${e}`);for(const t of s.range(b.length,i+1,1))b[t]=[],console.log(`Row ${t}`);for(const t of s.range(b[i].length,e+1,1))b[i][t]=[i,t],console.log(`Cell ${i} ${t}`);return b[i][e]}class N{constructor(){this.width=6,this.height=10,this.maxGroup=6,this.score=0,this.combo=0,this.board=[],this.messages=[]}start(){this.score=0,this.combo=0,this.messages=[],this.fillBoard()}fillBoard(){this.board=s.map(s.range(this.height),()=>s.map(s.range(this.width),()=>x.random())),this.coolBoard()}rotateChain(e){let[t,o]=e[0],c=this.board[t][o];for(let l of s.range(1,e.length)){let[d,a]=e[l],f=c;c=this.board[d][a],this.board[d][a]=f}this.board[t][o]=c,this.coolBoard(),this.newRow(),this.coolBoard()}neighbors([e,t]){let o=[];return e>0&&o.push(w(e-1,t)),t>0&&o.push(w(e,t-1)),e<this.height-1&&o.push(w(e+1,t)),t<this.width-1&&o.push(w(e,t+1)),o}pieceAt([e,t]){return this.board[e][t]}coolBoard(){let e=s.map(s.range(this.height),()=>s.map(s.range(this.width),()=>0));for(const t of s.range(this.height))for(const o of s.range(this.width)){if(e[t][o]>0)continue;let c=w(t,o),l=new Set([c]),d=new Set(this.neighbors(c));for(const a of d)if(this.pieceAt(c).kind==this.pieceAt(a).kind){l.add(a);for(const f of this.neighbors(a))l.has(f)||d.add(f)}for(const a of l){let[f,C]=a;e[f][C]=l.size;let p=this.pieceAt(a);p.heat=Math.min(p.heat,Math.max(0,this.maxGroup-l.size))}}}newRow(){this.board.shift(),this.board.push(s.map(s.range(this.width),()=>x.random()))}}const P={"pointer-events":"all"},V=["fill"],q=["stroke"],H={x:"-0.5",y:"0.7",fill:"white"},K={props:{piece:Object,active:Boolean,first:Boolean},setup(i){const e=i;function t(){return{A:"red",B:"green",C:"blue",D:"orange",E:"cyan"}[e.piece.kind]}function o(){return e.first?"black":e.active?"silver":"none"}return(c,l)=>(_(),g("g",P,[v("circle",{cx:"0",cy:"0",r:"1.3",fill:t()},null,8,V),v("rect",{x:"-1.4",y:"-1.4",width:"2.8",height:"2.8",stroke:o(),"stroke-width":"0.2",fill:"none"},null,8,q),v("text",H,M(i.piece.heat),1)]))}};var O=$(K,[["__scopeId","data-v-210dce09"]]);const T=i=>(R("data-v-33cfcf22"),i=i(),D(),i),Y=["onClick"],J={class:"wrapper"},Q=["cursor"],U=T(()=>v("rect",{x:"0",y:"0",width:"24",height:"35",fill:"none",stroke:"black","stroke-width":"0.1"},null,-1)),W=["data-id"],X={setup(i){let e=S(new N),t=k(!1),o=k([]);function c(){e.start()}function l(){let h=[];return e.board.forEach((n,r)=>n.forEach((u,m)=>{h.push({i:r,j:m,piece:u})})),s.sortBy(h,({piece:n})=>n.id)}function d(h,n){t.value?p():(t.value=!0,o.value=[[h,n]])}function a(h,n){return o.value.findIndex(([r,u])=>r==h&&u==n)}function f(h,n){if(t.value){var r=a(h,n);r==0?C():r>0?o.value.splice(r+1):o.value.push([h,n])}}function C(){e.rotateChain(o.value),p()}function p(){t.value=!1,o.value=[]}return(h,n)=>(_(),g(y,null,[v("button",{onClick:B(c,["stop"])},"Start",8,Y),v("div",J,[(_(),g("svg",{class:"puzzle-board cooling-board",ref:"svg",viewBox:"0 0 24 35",preserveAspectRatio:"xMidYMid meet",cursor:A(e).active_piece?"none":"auto",onContextmenu:n[0]||(n[0]=B(()=>{},["prevent"])),onMouseleave:n[1]||(n[1]=r=>p())},[U,(_(!0),g(y,null,E(l(),({i:r,j:u,piece:m})=>(_(),g("g",{key:m.id,class:"piece-container","data-id":m.id,style:G(`transform: translate(${4.5+3*u}px, ${4.5+3*r}px)`)},[z(O,{piece:m,active:a(r,u)>=0,first:a(r,u)==0,onClick:I=>d(r,u),onMouseenter:I=>f(r,u)},null,8,["piece","active","first","onClick","onMouseenter"])],12,W))),128))],40,Q))])],64))}};var Z=$(X,[["__scopeId","data-v-33cfcf22"]]);const j={name:"Home",components:{CoolingBoard:Z}},ee={class:"puzzle"};function te(i,e,t,o,c,l){const d=F("CoolingBoard");return _(),g("div",ee,[z(d)])}var ie=$(j,[["render",te]]);export{ie as default};

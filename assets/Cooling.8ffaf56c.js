import{_ as $,o as v,c as g,a as d,t as w,j as G,k as A,h as F,u as k,F as z,r as L,p as N,i as O,e as C,n as M,d as T}from"./index.b3106b40.js";import{_ as i}from"./lodash.45c0b1b1.js";let V=["A","B","C","D","E"];class y{constructor(t,e){this.id=i.uniqueId("piece"),this.kind=t,this.heat=e}score(){return 3-this.heat}static random(){return new y(i.sample(V),3)}}let b=[];function _(a,t){for(const e of i.range(b.length,a+1,1))b[e]=[];for(const e of i.range(b[a].length,t+1,1))b[a][e]=[a,e];return b[a][t]}class q{constructor(){this.width=6,this.height=10,this.maxGroup=6,this.scoreDecay=.5,this.lastScore=0,this.averageScore=null,this.messages=[],this.board=[]}start(){this.lastScore=0,this.averageScore=null,this.messages=[],this.fillBoard()}fillBoard(){this.board=i.map(i.range(this.height),()=>i.map(i.range(this.width),()=>y.random())),this.coolBoard()}boardScore(){return i.sumBy(this.board,t=>i.sumBy(t,e=>e.score()))}rotateChain(t,e){let s=t.map(([c,h])=>({u:c,v:h,piece:this.pieceAt([c,h],t,e)}));for(const{u:c,v:h,piece:l}of s)this.board[c][h]=l;this.coolBoard(),this.newRow(),this.coolBoard()}neighbors([t,e]){let s=[];return t>0&&s.push(_(t-1,e)),e>0&&s.push(_(t,e-1)),t<this.height-1&&s.push(_(t+1,e)),e<this.width-1&&s.push(_(t,e+1)),s}pieceAt([t,e],s=[],c=0){s=s.map(([m,S])=>_(m,S));let h=_(t,e),l=s.indexOf(h);if(l==-1||!c)return this.board[t][e];let u=s.at((l-c)%s.length),[p,x]=u;return this.board[p][x]}coolBoard(){let t=i.map(i.range(this.height),()=>i.map(i.range(this.width),()=>0));for(const e of i.range(this.height))for(const s of i.range(this.width)){if(t[e][s]>0)continue;let c=_(e,s),h=new Set([c]),l=new Set(this.neighbors(c));for(const u of l)if(this.pieceAt(c).kind==this.pieceAt(u).kind){h.add(u);for(const p of this.neighbors(u))h.has(p)||l.add(p)}for(const u of h){let[p,x]=u;t[p][x]=h.size;let m=this.pieceAt(u);m.heat=Math.min(m.heat,Math.max(0,this.maxGroup-h.size))}}}newRow(){this.score(this.board.shift()),this.board.push(i.map(i.range(this.width),()=>y.random()))}score(t){this.lastScore=i.sumBy(t,e=>e.score()),this.averageScore===null?this.averageScore=this.lastScore:this.averageScore=this.averageScore*(1-this.scoreDecay)+this.lastScore*this.scoreDecay}}const H={"pointer-events":"none"},K=["fill"],Y={x:"-0.5",y:"0.7",fill:"white"},J={props:{piece:Object},setup(a){const t=a;function e(){return{A:"red",B:"green",C:"blue",D:"orange",E:"cyan"}[t.piece.kind]}return(s,c)=>(v(),g("g",H,[d("circle",{cx:"0",cy:"0",r:"1.3",fill:e()},null,8,K),d("text",Y,w(a.piece.score()),1)]))}};var Q=$(J,[["__scopeId","data-v-2fa2384d"]]);const U={"pointer-events":"all"},W=["stroke"],X={props:{active:Boolean,first:Boolean},setup(a){const t=a;function e(){return t.first?"black":t.active?"silver":"none"}return(s,c)=>(v(),g("g",U,[d("rect",{x:"-1.4",y:"-1.4",width:"2.8",height:"2.8",stroke:e(),"stroke-width":"0.2",fill:"none"},null,8,W)]))}};const Z=a=>(N("data-v-358d89dc"),a=a(),O(),a),j=["onClick"],ee={class:"score-box"},te={class:"wrapper"},se=Z(()=>d("rect",{x:"0",y:"0",width:"24",height:"35",fill:"none",stroke:"black","stroke-width":"0.1"},null,-1)),oe={setup(a){let t=G(new q),e=A([]),s=A(null);function c(){t.start()}function h(){let n=[];if(!t.board.length)return n;for(const o of i.range(t.height))for(const r of i.range(t.width))n.push({i:o,j:r,piece:t.pieceAt([o,r],e.value,s.value)});return i.sortBy(n,({piece:o})=>o.id)}function l(n,o){return e.value.findIndex(([r,f])=>r==n&&f==o)}function u(n,o){return`transform: translate(${4.5+3*o}px, ${4.5+3*n}px)`}function p(n,o){let r=l(n,o);s.value&&r>=0?R():e.value.length?B():m(n,o)}function x(n,o){s.value!==null?P(n,o):l(n,o)==0&&e.value.length>2?D():e.value.length&&S(n,o)}function m(n,o){e.value=[[n,o]]}function S(n,o){var r=l(n,o);r>=0?e.value.splice(r+1):e.value.push([n,o])}function D(){s.value=0}function P(n,o){var r=l(n,o);r>=0&&(s.value=r)}function R(){t.rotateChain(e.value,s.value),B()}function B(){e.value=[],s.value=null}return(n,o)=>(v(),g(z,null,[d("button",{onClick:F(c,["stop"])},"Start",8,j),d("div",ee,[d("p",null,"Last: "+w(k(t).lastScore),1),d("p",null,"Avg: "+w(k(t).averageScore),1),d("p",null,"Board: "+w(k(t).boardScore()),1)]),d("div",te,[(v(),g("svg",{class:"puzzle-board cooling-board",ref:"svg",viewBox:"0 0 24 35",preserveAspectRatio:"xMidYMid meet",onMouseleave:o[0]||(o[0]=r=>B())},[se,(v(!0),g(z,null,L(h(),({i:r,j:f,piece:I})=>(v(),g("g",{key:I.id,class:"piece-container"},[C(X,{active:l(r,f)>=0,first:l(r,f)==0,style:M(u(r,f)),onClick:E=>p(r,f),onMouseenter:E=>x(r,f)},null,8,["active","first","style","onClick","onMouseenter"]),C(Q,{piece:I,style:M([{transition:"transform 0.5s"},u(r,f)])},null,8,["piece","style"])]))),128))],544))])],64))}};var ne=$(oe,[["__scopeId","data-v-358d89dc"]]);const ie={name:"Home",components:{CoolingBoard:ne}},re={class:"puzzle"};function ae(a,t,e,s,c,h){const l=T("CoolingBoard");return v(),g("div",re,[C(l)])}var he=$(ie,[["render",ae]]);export{he as default};
